<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Carte interactive Festival Soy</title>
    <meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' />
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
          /* STYLE la zone dessus la carte et sa police et son texte */
.map-overlay-container {
    position: absolute;
    width: 100%;
    top: 0px;
    left: 0;
    padding: 10px;
    z-index: 1;
}
.map-overlay {
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    background-color: #fff;
    max-height: 50%;
    border-radius: 3px;
    padding: 10px;
    box-shadow:0 1px 2px rgba(0,0,0,0.20);
}
#button-center {
    z-index: 1;
    position:fixed; bottom:10%;padding:20px;width:60%; left:20%
}
p	{
max-height: 60px; overflow: auto
}
.map-overlay h2,
.map-overlay p {
    margin: 0 0 10px;
}
@media (min-width:801px) {.map-overlay-container {width:40%} p{max-height:800px}}
    </style>
        <script src="https://use.fontawesome.com/acc5504c96.js"></script>

</head>
<div id="localise" >
   <button id=button-center onclick="getLocation()"> <h3> ACTIVER LOCALISATION</h3> </button>
    </div>
<div id='map'></div>

<div class='map-overlay-container'>
  


    <h3 id='location-title'>DU 25 AU 29 OCTOBRE 2017 À NANTES</h3>
    <p id='location-description'> 
Ride, Kevin Morby, Fennesz, Zombie Zombie, Chad Vangaalen, Petit Fantôme, Blanck Mass, Marietta, Jessica 93, Julien Gasc, Flotation Toy Warning, John Maus, Rhys Chatham + Will Guthrie, Orson Hentschel, Cotillon, Accident Du Travail, Loscil, Puce Mary, Carl Stone, Doppeltgänger, Big | Brave, Larsen, Jessica Moss, Trupa Trupa, Seabuckthorn, Tonstartssbandht, Mary Ocher, Charlotte Bendiks.</p>
<p id='location-price'> <a href="https://festival.soy/programmation">Plus d'info festival Soy</a></p>
<center>
<div id='itinerary' class='w3-row-padding'>
    
  </div>
  </center>
   
  </div>

    </div>
<script>
var geovelostart="47.213991,-1.555275";
var destineostart="-1.555275%3B47.213991";
var geoveloend=null;
var destineoend=null;
mapboxgl.accessToken = 'pk.eyJ1IjoiY29yZW50aW5sZW1haXRyZSIsImEiOiJjamJmMTkwNjMxeHZtMnBteGdxejlscmtqIn0.vO1AFeimgoh60XWlYRzVMw';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/corentinlemaitre/cj7hhiw2g4gwl2smmy24crlk4',
    center: [-1.55, 47.23],
    zoom: 12
});
map.on('load', function () {
    map.addLayer({
        "id": "points",
        "type": "symbol",
        "source": {
            "type": "geojson",
            "data": {
                "type": "FeatureCollection",
                "features": [
                { "type": "Feature", "properties": { "id": "Me 20h", "title": "Stereolux - Micro", "description": "Flotation Toy Warning \/ Pop cinématique \/ Talitres \/ GB<\/br>Marietta \/ Pop lo-fi \/ Born Bad \/ FR<\/br>Julien Gasc \/ Pop baroque \/ Born Bad \/ FR<\/br>Cotillon  \/ Pop garage \/ Burger \/ USA", "date": "MERCREDI 25 OCTOBRE : 20H00", "prix": "Prix : 15\/18€", "idnum": 2, "latlondest": "47.2050881465827,-1.5634414592", "destineodest": "-1.56344145927224%3B47.2050881" }, "geometry": { "type": "Point", "coordinates": [ -1.563441459272242, 47.205088146582654 ] } },
{ "type": "Feature", "properties": { "id": "Me 18h", "title": "Le Nid : Tour de Bretagne", "description": "Charlotte Bendiks \/ Electro \/  Love OD Communications \/ NOR", "date": "MERCREDI 25 OCTOBRE : 18H30", "prix": "Accès au nid (1€)", "idnum": 1, "latlondest": "47.2175585773195,-1.5582051749", "destineodest": "-1.5582051749212%3B47.21755857" }, "geometry": { "type": "Point", "coordinates": [ -1.558205174921201, 47.217558577319494 ] } },
{ "type": "Feature", "properties": { "id": "Di 15h", "title": "Musée d’Arts de Nantes - Galerie d'Art Moderne ", "description": "Carl Stone \/ Electro minimale \/ Unseen Worlds \/ USA-JAP <\/br>Accident du travail \/ Ambient \/ Bruit Direct \/ FR", "date": "DIMANCHE 29 OCTOBRE : 15H00", "prix": "Accès au Musée (4\/8€)", "idnum": 9, "latlondest": "47.219380742956,-1.54718848222", "destineodest": "-1.54718848222384%3B47.2193807" }, "geometry": { "type": "Point", "coordinates": [ -1.547188482223842, 47.21938074295602 ] } },
{ "type": "Feature", "properties": { "id": "Je 20h", "title": "Le lieu unique - Foyer haut", "description": "Jessica93 \/ Grunge coldwave DIY \/ Teenage Menopause \/ FR<\/br>Big l Brave \/ Post-rock noise \/ Southern Lord\/ CAN<\/br>Jessica Moss \/ Post-rock minimaliste \/ Constellation \/CAN<\/br>Larsen \/ Post-rock expérimental \/ Important \/ IT", "date": "JEUDI 26 OCTOBRE : 20H00", "prix": "Prix : 10\/13€", "idnum": 3, "latlondest": "47.215508233783,-1.54572521763", "destineodest": "-1.54572521763698%3B47.2155082" }, "geometry": { "type": "Point", "coordinates": [ -1.545725217636976, 47.215508233783005 ] } },
{ "type": "Feature", "properties": { "id": "Ve 18h", "title": "Mira boutique : 1B rue de Voltaire", "description": "Seabuckthorn \/ Folk psyché \/ Lost Tribe Sound \/ GB", "date": "VENDREDI 27 OCTOBRE : 18H30", "prix": "Gratuit", "idnum": 4, "latlondest": "47.2126062106944,-1.5636328289", "destineodest": "-1.56363282893828%3B47.2126062" }, "geometry": { "type": "Point", "coordinates": [ -1.563632828938275, 47.212606210694354 ] } },
{ "type": "Feature", "properties": { "id": "Ve 20h", "title": "Pôle étudiant (Université de Nantes)", "description": "Petit Fantôme \/ Pop \/ Because \/ FR<\/br>Blanck Mass \/ Electro noise \/ Sacred Bones  \/ GB<\/br>Orson Hentschel \/ Electro expérimentale \/ Denovali \/ ALL<\/br>Trupa trupa \/ Post-krautrock \/ Ici d’Ailleurs \/ POL<\/br>Puce Mary \/ Industriel noise \/ Posh Isolation \/ DAN", "date": "VENDREDI 27 OCTOBRE : 20H00", "prix": "Prix : 15\/18 €", "idnum": 5, "latlondest": "47.2452812732577,-1.5516321578", "destineodest": "-1.55163215783919%3B47.2452812" }, "geometry": { "type": "Point", "coordinates": [ -1.551632157839191, 47.245281273257675 ] } },
{ "type": "Feature", "properties": { "id": "Sa 15h", "title": "Centre Chorégraphique National de Nantes", "description": "Rhys Chatham + Will Guthrie \/ Post-minimalisme \/ USA-AUS<\/br>Loscil \/ Electro ambient  \/ Kranky \/ CAN", "date": "SAMEDI 28 OCTOBRE : 15H00", "prix": "Prix : 8\/11€", "idnum": 6, "latlondest": "47.226,-1.5626", "destineodest": "-1.5626%3B47.226" }, "geometry": { "type": "Point", "coordinates": [ -1.5626, 47.226 ] } },
{ "type": "Feature", "properties": { "id": "Sa 18h", "title": "Pioche : 10 rue de Bel air", "description": "Doppeltgänger \/ Electro synthwave \/ Autoprod. \/ ESP", "date": "SAMEDI 28 OCTOBRE : 18H00", "prix": "Gratuit", "idnum": 7, "latlondest": "47.2211234364572,-1.5589382", "destineodest": "-1.5589382%3B47.2211234364572" }, "geometry": { "type": "Point", "coordinates": [ -1.5589382, 47.221123436457241 ] } },
{ "type": "Feature", "properties": { "id": "Sa 19h", "title": "Maison de quartier de Doulon", "description": "Zombie Zombie \/ Krautrock psyché \/ Versatile \/ FR <\/br>John Maus \/ Synth-pop philosophique \/ Domino \/ USA<\/br>Chad VanGaalen \/ Folk rock \/ Sub Pop \/ CAN<\/br>Tonstartssbandht \/ Psych rock lo-fi \/ Mexican Summer \/ USA", "date": "SAMEDI 28 OCTOBRE : 19H30", "prix": "Prix : 16\/19€", "idnum": 8, "latlondest": "47.2369244637057,-1.5092559541", "destineodest": "-1.50925595413254%3B47.2369244" }, "geometry": { "type": "Point", "coordinates": [ -1.509255954132539, 47.236924463705734 ] } },
{ "type": "Feature", "properties": { "id": "Di 18h", "title": "Le lieu unique - Bar et Grand atelier", "description": "Kevin Morby \/ Folk rock \/ Dead Oceans \/ USA<\/br>Mary Ocher \/ Expérimental \/ Klangbad \/ RUS-ALL<\/br>Ride \/ Shoegaze \/ Wichita \/ GB", "date": "DIMANCHE 29 OCTOBRE : 18H00", "prix": "Prix : 22\/29€", "idnum": 10, "latlondest": "47.2154225418412,-1.5453365147", "destineodest": "-1.54533651472602%3B47.2154225" }, "geometry": { "type": "Point", "coordinates": [ -1.545336514726019, 47.215422541841214 ] } 
                    }
                ]
            }
        },
        "layout": {
            "icon-image": "cicrcle-15",
            "text-field": "{id}",
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-offset": [0, 0],
            "text-anchor": "center"
        }
        
        
    });
    
    // When a click event occurs on a feature in the states layer, open a popup at the
    // location of the click, with description HTML from its properties.
    map.on('click', 'points', function (e) {
        new mapboxgl.Popup()
            .setLngLat(e.features[0].geometry.coordinates)
            .setHTML(e.features[0].properties.title)
            .addTo(map);
        map.flyTo({center : e.features[0].geometry.coordinates});
        document.getElementById("location-title").innerHTML = e.features[0].properties.date;
        document.getElementById("location-description").innerHTML = e.features[0].properties.description;
        document.getElementById("location-price").innerHTML = e.features[0].properties.prix;
        geoveloend = e.features[0].properties.latlondest
        destineoend = e.features[0].properties.destineodest
        var geovelo_url = "https://www.geovelo.fr/nantes/itinerary/search?profile=MEDIAN&bikeType=TRADITIONAL&wayPoints="+geovelostart+"%7C"+e.features[0].properties.latlondest;
   	var destineo_url = "http://www.destineo.fr/fr/journey/result/?search%5Bfrom%5D%5Bautocomplete%5D=Votre+Position&search%5Bfrom%5D%5Bautocomplete-hidden%5D="+destineostart+"&search%5Bto%5D%5Bautocomplete%5D=Festival+Soy&search%5Bto%5D%5Bautocomplete-hidden%5D="+e.features[0].properties.destineodest+"&search%5Bdatetime_represents%5D=arrival&search%5Bdatetime%5D%5Btime%5D%5Bhour%5D=15&search%5Bdatetime%5D%5Btime%5D%5Bminute%5D=0&search%5Bdatetime%5D%5Bdate%5D=29%2F09%2F2017&search%5Bmodes%5D%5B%5D=physical_mode%3ALocalTrain&search%5Bmodes%5D%5B%5D=physical_mode%3ATramway&search%5Bmodes%5D%5B%5D=physical_mode%3ABus&search%5Bmodes%5D%5B%5D=physical_mode%3ACoach&search%5Bcount%5D=&search%5Bmin_nb_journeys%5D=2&search%5Bmax_nb_journeys%5D=3";
         document.getElementById("itinerary").innerHTML = "<div class='w3-row-padding'><a href="+geovelo_url+" target=_blank class='w3-center w3-xxxlarge'><button><i class='fa fa-bicycle' title='Venir à vélo'></i> </button></a>      <a href="+destineo_url+" target=_blank class='w3-xxxlarge w3-center'><button><i class='fa fa-bus fa-fw' title='Venir en bus'></i></button></a></div>";
        
        });
    // Change the cursor to a pointer when the mouse is over the states layer.
    map.on('mouseenter', 'points', function () {
        map.getCanvas().style.cursor = 'pointer';
    });
    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'points', function () {
        map.getCanvas().style.cursor = '';
    });
});
var x = document.getElementById("localise");
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}
function showPosition(position) {
    var latlon = position.coords.latitude + "," + position.coords.longitude;
    geovelostart = latlon;
    destineostart = position.coords.longitude + "%3B" + position.coords.latitude
	x.innerHTML = "<br>";
    // add a function to put on image as a link
}
function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
    }
}
</script>



</html>
